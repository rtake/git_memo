# Git - リモート操作の基本知識
2023.01.27 by rtake

<br>

## 3行で説明すると
* ``` git pull ``` でリモートリポジトリからブランチの最新版をコピーして
* ``` git commit ``` で手元での作業をコミットし
* ``` git push ``` すると、手元での作業をリモートに反映することができる

<br>

## もう少し詳しい説明
### リモートリポジトリって何？
* サーバ上に存在するリポジトリのこと。
    * GitHubやAzure DevOpsなどを使う人が多い
    * 自分のサーバに作成することもできる(https://webbibouroku.com/Blog/Article/git-local-remote-repo#outline__2_1)
* 複数人で共同作業する場合に便利
    * 逆に、バージョン管理ツールとして使用するだけならば必須ではない[要出典] 
* リモートリポジトリのブランチ(リモートブランチ)にコミットするためには、ローカルリポジトリのブランチにリモートブランチを対応付ける必要がある。
    * ローカル環境でリモートブランチを直接操作することはできない[要出典]。
    * ``` git branch -u [branch_name] ``` とすれば、今いるブランチとリモートブランチを対応付けることができる。
    * 実際には、ローカルブランチとリモートブランチの間に **リモート追跡ブランチ** が存在する。(後述)

<br>

### リモート追跡ブランチって何？
* ローカルリポジトリに存在し、リモートブランチに対応付けられているブランチのこと。(リモートブランチを追跡**する**ブランチ)
    * https://qiita.com/uasi/items/69368c17c79e99aaddbf の図がわかりやすい。
    * 正確には、リモートブランチの参照(ポインタ)
        > リモート追跡ブランチは、リモートブランチの状態を保持する参照です。 ローカルに作成される参照ですが、自分で移動することはできません。ネットワーク越しの操作をしたときに自動的に移動します。 リモート追跡ブランチは、前回リモートリポジトリに接続したときにブランチがどの場所を指していたかを示すブックマークのようなものです。
        
        (https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E6%A9%9F%E8%83%BD-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81)

* ローカルブランチがリモート追跡ブランチを追跡するように設定することで、リモートブランチとローカルブランチを対応付けることができる。
    * ``` git branch -u [remotename]/[branch] ``` で、今いるブランチに追跡対象のリモート追跡ブランチを設定できる。
    * [ローカルブランチ] ->(追跡する)-> [リモート追跡ブランチ] ->(追跡する)-> [リモートブランチ] 
    * ``` git fetch ``` では、**リモート追跡ブランチをリモートブランチの最新版に更新**する。
    * ``` git pull ``` では、``` git fetch ``` の後に **ローカルブランチにリモート追跡ブランチをマージ**する。
        * つまり、[ pull = fetch + merge ]
        * https://qiita.com/wann/items/688bc17460a457104d7d

<br>

## リモート操作のお困りごとと解消法
### (1) git pullしたのに、リモートの変更がローカルに反映されない！
1. まずは ``` git branch -a ``` で目的のリモートブランチを追跡するリモート追跡ブランチがあるか確認する。
    * リモートブランチを追跡できていない場合は、``` git fetch ``` でリモート追跡ブランチ作成 
2. ``` git branch -vv ``` で、ローカルブランチがリモート/リモート追跡ブランチを追跡できているか確認する。
    * 追跡できてない場合は、ローカルリポジトリで対象のブランチに移動し ``` git branch -u [remotename]/[branch] ``` とする。
        * ``` [remotename]/[branch] ``` はリモート追跡ブランチ
3. ``` git fetch ``` でリモート追跡ブランチを最新のリモートブランチに更新する。
4. ``` git pull ``` すれば最新版のリモートブランチが反映される[要出典]。
    * ここはリモート追跡ブランチをローカルブランチにmergeするだけでもいい(pull = fetch + merge で、3ですでにfetchしているため)

<br>

### (2) 特に何もしていないのにpull/pushできているけど大丈夫？
* ``` git clone ``` した場合には自動的にリモート追跡リポジトリが設定されるので問題ない[要出典]。

<br>

### (3) リモートブランチからローカルブランチを作りたい(checkoutしたい) 
* ``` git checkout -b [local_branch_name] [origin/remote_branch_name] ```
    * 参考: https://qiita.com/YusukeSuzuki@github/items/3bd5752783fd2c2f8805

<br>

### (4) いまいるローカルブランチに、追跡させるリモートブランチを設定したい
* ``` git branch -u [remotename]/[branch] ```
* または ``` git push -u remote branch ```

<br>

### (5) ローカルブランチをリモートブランチに登録したい
* (なにやりたかったんだっけ)
* たぶん ``` git push -u remote branch ``` みたいなこと

